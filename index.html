<html>
  <head>
    <style>
      body {
        margin: 0;
        padding: 0;
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      }
    </style>
  </head>
  <body>
    <div id="app"></div>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <script type="text/babel">
      // Utility functions
      const clampHue = (h) => ((h % 360) + 360) % 360;

      function hslToHex(h, s, l) {
        s /= 100;
        l /= 100;
        const c = (1 - Math.abs(2 * l - 1)) * s;
        const x = c * (1 - Math.abs((h / 60) % 2 - 1));
        const m = l - c / 2;
        let r = 0, g = 0, b = 0;

        if (0 <= h && h < 60) {
          r = c; g = x; b = 0;
        } else if (60 <= h && h < 120) {
          r = x; g = c; b = 0;
        } else if (120 <= h && h < 180) {
          r = 0; g = c; b = x;
        } else if (180 <= h && h < 240) {
          r = 0; g = x; b = c;
        } else if (240 <= h && h < 300) {
          r = x; g = 0; b = c;
        } else if (300 <= h && h < 360) {
          r = c; g = 0; b = x;
        }

        r = Math.round((r + m) * 255);
        g = Math.round((g + m) * 255);
        b = Math.round((b + m) * 255);

        return "#" + ((1 << 24) + (r << 16) + (g << 8) + b).toString(16).slice(1).toUpperCase();
      }

      function parseHsl(hslString) {
        const match = hslString.match(/hsl\((\d+(?:\.\d+)?)\s+(\d+(?:\.\d+)?)%\s+(\d+(?:\.\d+)?)%\)/);
        if (match) {
          return {
            h: parseFloat(match[1]),
            s: parseFloat(match[2]),
            l: parseFloat(match[3])
          };
        }
        return { h: 0, s: 0, l: 0 };
      }

      function makePalette(baseHue, mode, lockedColors = []) {
        const baseS = 70;
        const baseL = 50;

        const vary = (i) => ({
          s: Math.max(45, Math.min(85, baseS + (i - 2) * 5)),
          l: Math.max(35, Math.min(65, baseL + (i - 2) * 4)),
        });

        let hueOffsets = [];
        if (mode === "analogous") hueOffsets = [-40, -20, 0, 20, 40];
        if (mode === "triadic") hueOffsets = [-120, 0, 120, -60, 60];
        if (mode === "split") hueOffsets = [-150, 0, 150, -30, 30];

        return hueOffsets.map((off, i) => {
          // If this color is locked, keep the existing color
          if (lockedColors[i]) {
            return lockedColors[i];
          }
          
          const { s, l } = vary(i);
          const h = clampHue(baseHue + off);
          return `hsl(${h} ${s}% ${l}%)`;
        });
      }

      function randomHue() {
        return Math.floor(Math.random() * 360);
      }

      function randomMode() {
        const modes = ["analogous", "triadic", "split"];
        return modes[Math.floor(Math.random() * modes.length)];
      }

      // Copy Icon Component
      const CopyIcon = ({ size = 16, color = "white" }) => (
        <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke={color} strokeWidth="2">
          <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
          <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
        </svg>
      );

      // Lock Icon Component
      const LockIcon = ({ size = 20, color = "white", locked = false }) => (
        <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke={color} strokeWidth="2.5">
          <rect x="3" y="11" width="18" height="11" rx="2" ry="2"></rect>
          <path d={locked ? "M7 11V7a5 5 0 0 1 10 0v4" : "M7 11V7a5 5 0 0 1 9.9-1"}></path>
        </svg>
      );

      // Keyboard Icon Component
      const KeyboardIcon = ({ size = 16, color = "#666" }) => (
        <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke={color} strokeWidth="2">
          <rect x="2" y="4" width="20" height="16" rx="2"></rect>
          <path d="M6 8h.01"></path>
          <path d="M10 8h.01"></path>
          <path d="M14 8h.01"></path>
          <path d="M18 8h.01"></path>
          <path d="M8 12h.01"></path>
          <path d="M12 12h.01"></path>
          <path d="M16 12h.01"></path>
          <path d="M7 16h10"></path>
        </svg>
      );

      function App() {
        const [hue, setHue] = React.useState(randomHue());
        const [mode, setMode] = React.useState(randomMode());
        const [lockedColors, setLockedColors] = React.useState(Array(5).fill(null));
        const [copiedIndex, setCopiedIndex] = React.useState(null);
        
        const colors = React.useMemo(() => makePalette(hue, mode, lockedColors), [hue, mode, lockedColors]);

        function handleGenerate() {
          setHue(randomHue());
          setMode(randomMode());
        }

        function toggleLock(index) {
          const newLocked = [...lockedColors];
          if (newLocked[index]) {
            newLocked[index] = null; // Unlock
          } else {
            newLocked[index] = colors[index]; // Lock with current color
          }
          setLockedColors(newLocked);
        }

        async function copyToClipboard(color, index) {
          const { h, s, l } = parseHsl(color);
          const hex = hslToHex(h, s, l);
          
          try {
            await navigator.clipboard.writeText(hex);
            setCopiedIndex(index);
            setTimeout(() => setCopiedIndex(null), 1000);
          } catch (err) {
            console.error('Failed to copy:', err);
          }
        }

        // Keyboard event listener - only for generate button focus
        React.useEffect(() => {
          function handleKeyPress(event) {
            if (event.code === 'Space' && event.target.id === 'generate-button') {
              event.preventDefault();
              handleGenerate();
            }
          }

          document.addEventListener('keydown', handleKeyPress);
          return () => document.removeEventListener('keydown', handleKeyPress);
        }, []);

        const containerStyle = {
          position: 'relative',
          height: '100vh',
          width: '100vw',
          overflow: 'hidden',
          margin: 0,
        };

        const columnsStyle = {
          display: 'flex',
          height: '100%',
          width: '100%'
        };

        const columnStyle = {
          flex: 1,
          display: 'flex',
          flexDirection: 'column',
          alignItems: 'center',
          justifyContent: 'center',
          padding: '24px',
          position: 'relative',
          cursor: 'pointer'
        };

        const lockButtonStyle = {
          position: 'absolute',
          top: '20px',
          right: '20px',
          background: 'rgba(0,0,0,0.3)',
          border: 'none',
          borderRadius: '50%',
          width: '44px',
          height: '44px',
          display: 'flex',
          alignItems: 'center',
          justifyContent: 'center',
          cursor: 'pointer',
          transition: 'all 0.2s ease',
          backdropFilter: 'blur(8px)'
        };

        const colorInfoStyle = {
          display: 'flex',
          alignItems: 'center',
          gap: '12px',
          backgroundColor: 'rgba(0,0,0,0.6)',
          color: 'white',
          fontSize: '16px',
          fontWeight: '500',
          padding: '16px 20px',
          borderRadius: '16px',
          userSelect: 'none',
          cursor: 'pointer',
          transition: 'all 0.2s ease',
          backdropFilter: 'blur(12px)'
        };

        const buttonContainerStyle = {
          position: 'absolute',
          bottom: '40px',
          left: '50%',
          transform: 'translateX(-50%)'
        };

        const buttonStyle = {
          display: 'flex',
          alignItems: 'center',
          gap: '10px',
          padding: '16px 32px',
          fontSize: '16px',
          fontWeight: '600',
          border: 'none',
          borderRadius: '50px',
          backgroundColor: 'white',
          color: '#333',
          cursor: 'pointer',
          boxShadow: '0 4px 16px rgba(0,0,0,0.15), 0 2px 4px rgba(0,0,0,0.1)',
          transition: 'all 0.2s ease'
        };

        return (
          <div style={containerStyle}>
            <div style={columnsStyle}>
              {colors.map((color, idx) => {
                const { h, s, l } = parseHsl(color);
                const hex = hslToHex(h, s, l);
                const isLocked = lockedColors[idx] !== null;
                const isCopied = copiedIndex === idx;

                return (
                  <div
                    key={idx}
                    style={{...columnStyle, backgroundColor: color}}
                  >
                    <button
                      onClick={() => toggleLock(idx)}
                      style={{
                        ...lockButtonStyle,
                        backgroundColor: isLocked ? 'rgba(255,255,255,0.2)' : 'rgba(0,0,0,0.3)'
                      }}
                    >
                      <LockIcon locked={isLocked} />
                    </button>
                    
                    <div 
                      style={{
                        ...colorInfoStyle,
                        backgroundColor: isCopied ? 'rgba(0,0,0,0.8)' : 'rgba(0,0,0,0.6)'
                      }}
                      onClick={() => copyToClipboard(color, idx)}
                      onMouseOver={(e) => e.target.style.transform = 'scale(1.05)'}
                      onMouseOut={(e) => e.target.style.transform = 'scale(1)'}
                    >
                      <span>{isCopied ? 'Copied!' : hex}</span>
                      {!isCopied && <CopyIcon />}
                    </div>
                  </div>
                );
              })}
            </div>
            
            <div style={buttonContainerStyle}>
              <button 
                id="generate-button"
                onClick={handleGenerate}
                style={buttonStyle}
                onMouseOver={(e) => {
                  e.target.style.transform = 'translateY(-2px)';
                  e.target.style.boxShadow = '0 6px 20px rgba(0,0,0,0.2), 0 4px 8px rgba(0,0,0,0.15)';
                }}
                onMouseOut={(e) => {
                  e.target.style.transform = 'translateY(0)';
                  e.target.style.boxShadow = '0 4px 16px rgba(0,0,0,0.15), 0 2px 4px rgba(0,0,0,0.1)';
                }}
              >
                <KeyboardIcon />
                Generate
              </button>
            </div>
          </div>
        );
      }

      const root = ReactDOM.createRoot(document.getElementById('app'));
      root.render(<App />);
    </script>
  </body>
</html>